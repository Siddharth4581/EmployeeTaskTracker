{% extends "base.html" %}
{% block title %}Home{% endblock %}
{% block content %}

<div class="container mt-4">
    <h2 class="mb-4 text-center">Your Tasks</h2>
    <!-- DASHBOARD SUMMARY -->
<div class="row text-center mb-4">

    <!-- Total Tasks -->
    <div class="col-md-3">
        <div class="card shadow-sm p-3">
            <h5>Total Tasks</h5>
            <h3 class="text-primary">{{ total_tasks }}</h3>
        </div>
    </div>

    <!-- Completed Tasks -->
    <div class="col-md-3">
        <div class="card shadow-sm p-3">
            <h5>Completed</h5>
            <h3 class="text-success">{{ completed_tasks }}</h3>
        </div>
    </div>

    <!-- Pending Tasks -->
    <div class="col-md-3">
        <div class="card shadow-sm p-3">
            <h5>Pending</h5>
            <h3 class="text-warning">{{ pending_tasks }}</h3>
        </div>
    </div>

    <!-- In Progress Tasks -->
    <div class="col-md-3">
        <div class="card shadow-sm p-3">
            <h5>In Progress</h5>
            <h3 class="text-info">{{ inprogress_tasks }}</h3>
        </div>
    </div>

</div>

<h4>Recent Activity</h4>
<ul class="list-group mb-4">
  {% for activity in activities %}
    <li class="list-group-item">
      {{ activity.action }} 
      <small class="text-muted">({{ activity.timestamp|date:"M d, Y H:i" }})</small>
    </li>
  {% empty %}
    <li class="list-group-item text-muted">No recent activity.</li>
  {% endfor %}
</ul>

    <!-- FILTER AND SORT CONTROLS -->
<div class="d-flex justify-content-between mb-4">

  <!-- SEARCH BAR -->
<form method="GET" class="mb-4 d-flex">
    <input type="text" name="search" class="form-control me-2"
           placeholder="Search tasks..."
           value="{{ search_query }}">
    <button type="submit" class="btn btn-secondary">Search</button>
</form>
    
  
  <form method="GET" class="d-flex">

    <!-- FILTER BY STATUS -->
    <select name="status" class="form-select me-2" onchange="this.form.submit()">
      <option value="All" {% if status_filter == 'All' %}selected{% endif %}>All Tasks</option>
      <option value="Pending" {% if status_filter == 'Pending' %}selected{% endif %}>Pending</option>
      <option value="In Progress" {% if status_filter == 'In Progress' %}selected{% endif %}>In Progress</option>
      <option value="Completed" {% if status_filter == 'Completed' %}selected{% endif %}>Completed</option>
    </select>

    <!-- SORT OPTIONS -->
    <select name="sort" class="form-select" onchange="this.form.submit()">
      <option value="created" {% if sort_option == 'created' %}selected{% endif %}>Sort: Latest First</option>
      <option value="deadline" {% if sort_option == 'deadline' %}selected{% endif %}>Sort: By Deadline</option>
    </select>

  </form>

</div>

    <!-- No tasks yet -->
    {% if not tasks %}
        <div class="alert alert-info text-center">
            No tasks found. <a href="{% url 'add_task' %}">Add your first task!</a>
        </div>
    {% endif %}

    <!-- Task list -->
    <div class="row">
        {% for task in tasks %}
        <div class="col-md-4 mb-3">
            <div class="card shadow-sm">
                <div class="card-body">
                    <h5 class="card-title">{{ task.title }}</h5>
                    <p class="card-text">{{ task.description|truncatewords:20 }}</p>
                    
                    <!-- STATUS BADGE -->
                    {% if task.status == "Pending" %}
                     <span class="badge bg-warning text-dark">Pending</span>
                      {% elif task.status == "In Progress" %}
                      <span class="badge bg-primary">In Progress</span>
                      {% elif task.status == "Completed" %}
                      <span class="badge bg-success">Completed</span>
                    {% endif %}

                    <p><strong>Deadline:</strong> {{ task.deadline }}</p>
                    <p><small class="text-muted">Created: {{ task.created_at|date:"M d, Y" }}</small></p>
                <!-- Edit & Delete Buttons -->
                <div class="d-flex justify-content-between mt-3">
                <a href="{% url 'edit_task' task.id %}" class="btn btn-sm btn-outline-primary">Edit</a>
                <a href="{% url 'delete_task' task.id %}" class="btn btn-sm btn-outline-danger"
                 onclick="return confirm('Are you sure you want to delete this task?');">Delete</a>
                 </div>
                </div>
            </div>
        </div>
        {% endfor %}
      <!-- PAGINATION -->
<div class="d-flex justify-content-center mt-4">
    <nav>
        <ul class="pagination">
            
            {% if page_obj.has_previous %}
            <li class="page-item">
                <a class="page-link" href="?page={{ page_obj.previous_page_number }}&status={{ status_filter }}&sort={{ sort_option }}&search={{ search_query }}">Previous</a>
            </li>
            {% endif %}

            <li class="page-item disabled">
                <span class="page-link">Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}</span>
            </li>

            {% if page_obj.has_next %}
            <li class="page-item">
                <a class="page-link" href="?page={{ page_obj.next_page_number }}&status={{ status_filter }}&sort={{ sort_option }}&search={{ search_query }}">Next</a>
            </li>
            {% endif %}
        </ul>
    </nav>
</div>  
    </div>
</div>

<script>
    // When the dropdown changes, submit the form automatically
    document.getElementById('filterForm').addEventListener('change', function() {
        this.submit();
    });
</script>






{% endblock %}

